<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="我有病，你有药嘛？"><meta name="keywords" content=""><meta name="author" content="Halohoop"><meta name="copyright" content="Halohoop"><title>我有病，你有药嘛？ | 卖牙膏的芖口钉</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8d386d3f58d003ed2f4b4d02e584d2ae";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://cdn.jsdelivr.net/gh/halohoop/cdn/github/avatar.jpg"></div><div class="author-info__name text-center">Halohoop</div><div class="author-info__description text-center">我有病，你有药嘛？</div><div class="follow-button"><a href="https://github.com/halohoop">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">33</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">39</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">7</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://www.kfc.com">KFC</a><a class="author-info-links__name text-center" href="https://www.mcdonalds.com.cn">Mcdonalds</a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">卖牙膏的芖口钉</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="site-info"><div id="site-title">卖牙膏的芖口钉</div><div id="site-sub-title">我有病，你有药嘛？</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/08/tricks_of_mac_001/">tricks_of_mac-001-MacOS对话框脱离鼠标操作</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-08 04:00:09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/cookies-tricks-of-mac/">cookies tricks_of_mac</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/mac/">mac</a></span><div class="content"><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>不知道你有没有发现当你在MacOS上删除一个文件或者一条短信的，你会得到一个类似下图这样的对话框，但是可能有时候默认的选中的按钮不是你想要的，这个时候按方向键是没有反应的，需要按<code>【TAB】</code>键。</p>
<p><img src="/2020/03/08/tricks_of_mac_001/1.png" alt="1"></p>
<p>于是你按了<code>【TAB】</code>键，发现<code>【删除】</code>按钮被蓝色框框选中了，这个时候你按<code>【回车】</code>，发现确是<code>【取消】</code>按钮被触发了。</p>
<p><img src="/2020/03/08/tricks_of_mac_001/2.png" alt="1"></p>
<h2 id="原因解释"><a href="#原因解释" class="headerlink" title="原因解释"></a>原因解释</h2><p>MacOS的对话框在按钮触发的设计上分的很细，分为：</p>
<ol>
<li>蓝色背景按钮的触发；</li>
<li>蓝色框框按钮的触发；</li>
</ol>
<p><strong><u>蓝色背景的按钮是通过<code>【回车】</code>来触发的，而蓝色框框的按钮则是通过<code>【空格Space键】</code>来触发的</u></strong></p>
<p>所以要完成以上删除场景的操作，正确的操作步骤应该是：<code>【TAB】</code>-&gt;<code>【SPACE】</code>。</p>
<p>Bye~</p>
<p>Hope it works~</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/05/meals-2020publish2jcenter/">[大餐]2020年最新使用gradle构建、上传并发布jar包/aar包到jcenter方法整理</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-05 23:32:02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jcenter/">jcenter</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/android/">android</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/aar/">aar</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/meals/">meals</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/jcenter/">jcenter</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/jar/">jar</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<p>下文中的所有操作基于的环境为：<br>    <code>MacOS v10.15.3 + Java v1.8 + Gradle v6.4 + Kotlin v1.3.41 + Android SDK</code><br>假设你已经具备以上环境；</p>
<h3 id="1-构建Jar包，并且上传到JCenter；"><a href="#1-构建Jar包，并且上传到JCenter；" class="headerlink" title="1. 构建Jar包，并且上传到JCenter；"></a>1. 构建Jar包，并且上传到JCenter；</h3><ul>
<li>TOC:</li>
<li><ol>
<li>gradle命令生成项目</li>
</ol>
</li>
<li><ol>
<li>添加发布插件；</li>
</ol>
</li>
<li><ol>
<li>定义生成相关产物的Gradle Tasks；</li>
</ol>
</li>
<li><ol>
<li>配置相关参数；</li>
</ol>
</li>
<li><ol>
<li>执行上传<code>task bintrayUpload</code></li>
</ol>
</li>
</ul>
<hr>
<ol>
<li>gradle命令生成项目<br> 我们在命令行用gradle命令帮我们生成一个项目； <figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir 2020jcenterpublish</div><div class="line">cd 2020jcenterpublish</div><div class="line">mkdir javaLibraryJarKotlin</div><div class="line">cd javaLibraryJarKotlin</div><div class="line">gradle init</div><div class="line"><span class="meta">#</span><span class="bash"> 选择library -&gt;..-&gt; Kotlin项目(也可以选择Java)</span></div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>这个时候在javaLibraryJarKotlin文件夹下，我们就得到了一个Gradle为我们生成的一个项目。
目录树如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── build.gradle</div><div class="line">├── gradle</div><div class="line">│   └── wrapper</div><div class="line">│       ├── gradle-wrapper.jar</div><div class="line">│       └── gradle-wrapper.properties</div><div class="line">├── gradlew</div><div class="line">├── gradlew.bat</div><div class="line">├── settings.gradle</div><div class="line">└── src</div><div class="line">    ├── main</div><div class="line">    │   ├── kotlin</div><div class="line">    │   │   └── com</div><div class="line">    │   │       └── halohoop</div><div class="line">    │   │           └── librarykotlinpublish</div><div class="line">    │   │               └── Library.kt</div><div class="line">    │   └── resources</div><div class="line">    └── test</div><div class="line">        ├── kotlin</div><div class="line">        │   └── com</div><div class="line">        │       └── halohoop</div><div class="line">        │           └── librarykotlinpublish</div><div class="line">        │               └── LibraryTest.kt</div><div class="line">        └── resources</div><div class="line">15 directories, 8 files</div></pre></td></tr></table></figure>

我们在这个工程的基础上再进行各种功能的迭代完善，现在假设这个就是我们最终编码完成的工程，我们要将其打包发布到JCenter。
</code></pre><ol>
<li><p>添加发布插件；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// rootProject/build.gradle</span></div><div class="line">plugins &#123;</div><div class="line">    <span class="comment">//省略一些代码...</span></div><div class="line">    id <span class="string">'com.jfrog.bintray'</span> version <span class="string">'1.8.5'</span></div><div class="line">    id <span class="string">'maven-publish'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>定义生成相关产物的Gradle Tasks；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// rootProject/build.gradle</span></div><div class="line"><span class="comment">//生成源码jar包task</span></div><div class="line">task sourcesJar(<span class="string">type:</span> Jar) &#123;</div><div class="line">    from sourceSets.main.allJava</div><div class="line">    archiveClassifier = <span class="string">'sources'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//生成javadoc jar包task</span></div><div class="line">task javadocJar(<span class="string">type:</span> Jar) &#123;</div><div class="line">    from javadoc</div><div class="line">    archiveClassifier = <span class="string">'javadoc'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置相关参数；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// rootProject/build.gradle</span></div><div class="line">bintray &#123;</div><div class="line">    user = <span class="string">'TODO 设置你的bintray.com用户名'</span></div><div class="line">    key = <span class="string">"$&#123;project.hasProperty('apiKey') ? project.apiKey : "</span><span class="string">"&#125;"</span></div><div class="line">    override = <span class="literal">true</span><span class="comment">//TODO 如果有相同版本是否覆盖</span></div><div class="line">    publish = <span class="literal">true</span><span class="comment">//TODO 是否上传后直接发布</span></div><div class="line">    pkg &#123;</div><div class="line">        repo = <span class="string">'maven'</span><span class="comment">//TODO 设置发布的maven库，在“bintray.com/你的用户名页面”就能够看到所有逇maven库名称</span></div><div class="line">        name = project.name<span class="comment">//TODO 项目的名称</span></div><div class="line">        userOrg = user<span class="comment">//TODO 用户所在组织</span></div><div class="line">        licenses = [<span class="string">'Apache-2.0'</span>]<span class="comment">//TODO 设置开源库的开源协议</span></div><div class="line">        vcsUrl = <span class="string">"github.com/halohoop/2020jcenterpublish"</span><span class="comment">//TODO 设置开源库地址</span></div><div class="line">        issueTrackerUrl = <span class="string">"github.com/halohoop/2020jcenterpublish/issue"</span><span class="comment">//TODO 设置开源库issue地址</span></div><div class="line">        version &#123;</div><div class="line">            name = <span class="string">'0.0.1'</span><span class="comment">//TODO 设置版本号</span></div><div class="line">            desc = <span class="string">"javaLibraryJarKotlin 0.0.1 final"</span></div><div class="line">            released = <span class="keyword">new</span> Date()<span class="comment">//TODO 发布时间</span></div><div class="line">            vcsTag = <span class="string">'0.0.1'</span><span class="comment">//TODO 设置版本tag</span></div><div class="line"><span class="comment">//            attributes = ['gradle-plugin': 'com.use.less:com.use.less.gradle:gradle-useless-plugin']//可忽略的属性，有需求可以查看官方文档进行相关配置</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//TODO 添加publishing DSL中定义的名称</span></div><div class="line">    publications = [<span class="string">'MyPublication'</span>]</div><div class="line">&#125;</div><div class="line">publishing &#123;</div><div class="line">    publications &#123;</div><div class="line">        MyPublication(MavenPublication) &#123;</div><div class="line">            <span class="comment">//标准开源库，以下都三个文件是标配</span></div><div class="line">            artifact(jar)<span class="comment">//TODO 配置库jar包</span></div><div class="line">            artifact(sourcesJar)<span class="comment">//TODO 配置库源码jar包</span></div><div class="line">            artifact(javadocJar)<span class="comment">//TODO 配置库javadoc jar包</span></div><div class="line">            groupId <span class="string">"com.halohoop"</span><span class="comment">//包名</span></div><div class="line">            artifactId <span class="string">'javalibraryjarkotlin'</span><span class="comment">//库id</span></div><div class="line">            version <span class="string">'0.0.1'</span><span class="comment">//TODO 设置版本号</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>执行上传<code>task bintrayUpload</code><br> bintrayUpload这个任务是<code>com.jfrog.bintray</code>插件提供给我们的，只要我们配置好相关的DSL就能够顺利执行这个task。<br> 为了不让我们的bintray.com账户密码信息暴露在项目的源码中，上文中的bintray DSL中的key属性采用的是动态获取apiKey属性的方式进行取值，因此我们在执行上传<code>task bintrayUpload</code>的时候需要使用<code>-P</code>传递一个<code>apiKey</code>属性参数.<br> 格式：<code>-Pkey=value</code><br> 示例：<code>./gradlew bintrayUpload -PapiKey=你的bintray.com密码或者apikey</code><br> 这个apiKey我们在<a href="https://bintray.com/profile/edit" target="_blank" rel="external">https://bintray.com/profile/edit</a>就能够获取到，如下图：<br> <img src="https://cdn.jsdelivr.net/gh/halohoop/cdn@1.5/github/bintrayapikey.png" alt="apikey"></p>
<h3 id="2-构建Aar包，并且上传到JCenter；"><a href="#2-构建Aar包，并且上传到JCenter；" class="headerlink" title="2. 构建Aar包，并且上传到JCenter；"></a>2. 构建Aar包，并且上传到JCenter；</h3></li>
</ol>
<ul>
<li>TOC:</li>
<li><ol>
<li>使用IDE Android Studio生成一个Android项目</li>
</ol>
</li>
<li><ol>
<li>添加发布插件；</li>
</ol>
</li>
<li><ol>
<li>定义生成相关产物的Gradle Tasks；</li>
</ol>
</li>
<li><ol>
<li>配置相关参数；</li>
</ol>
</li>
<li><ol>
<li>执行上传<code>task bintrayUpload</code></li>
</ol>
</li>
</ul>
<hr>
<ol>
<li><p>使用IDE Android Studio生成一个Android项目<br> 由于官方已不再支持使用”android”命令行创建一个android工程，因此我们使用Android Studio创建一个Library工程，其中的App module的名称命名为“androidlibrary”</p>
<ul>
<li>见：<a href="https://developer.android.com/studio/tools/help/android" target="_blank" rel="external">https://developer.android.com/studio/tools/help/android</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">已删去了不必要的文件</div><div class="line">.</div><div class="line">├── androidlibrary</div><div class="line">│   ├── build.gradle</div><div class="line">│   ├── consumer-rules.pro</div><div class="line">│   ├── libs</div><div class="line">│   ├── proguard-rules.pro</div><div class="line">│   └── src</div><div class="line">│       ├── androidTest</div><div class="line">│       │   └── java</div><div class="line">│       │       └── com</div><div class="line">│       │           └── halohoop</div><div class="line">│       │               └── androidlibraryaarkotlin2</div><div class="line">│       │                   └── ExampleInstrumentedTest.java</div><div class="line">│       ├── main</div><div class="line">│       │   ├── AndroidManifest.xml</div><div class="line">│       │   ├── java</div><div class="line">│       │   │   └── com</div><div class="line">│       │   │       └── halohoop</div><div class="line">│       │   │           └── androidlibraryaarkotlin2</div><div class="line">│       │   │               └── Library.kt</div><div class="line">│       │   └── res</div><div class="line">│       │       └── drawable</div><div class="line">│       └── test</div><div class="line">│           └── java</div><div class="line">│               └── com</div><div class="line">│                   └── halohoop</div><div class="line">│                       └── androidlibraryaarkotlin2</div><div class="line">│                           └── ExampleUnitTest.java</div><div class="line">├── build.gradle</div><div class="line">├── gradle</div><div class="line">│   └── wrapper</div><div class="line">│       ├── gradle-wrapper.jar</div><div class="line">│       └── gradle-wrapper.properties</div><div class="line">├── gradle.properties</div><div class="line">├── gradlew</div><div class="line">├── gradlew.bat</div><div class="line">├── local.properties</div><div class="line">└── settings.gradle</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>将App Module修改为Library Module</p>
<ul>
<li>打开文件<code>./androidlibrary/build.gradle</code></li>
<li>将其中的插件<code>apply plugin: &#39;com.android.application&#39;</code>修改为<code>apply plugin: &#39;com.android.library&#39;</code></li>
<li>删去applicationId：<code>android { defaultConfig { applicationId &quot;xxx.xxxxx.xx&quot; }}</code></li>
</ul>
</li>
<li><p>添加发布插件； </p>
<ul>
<li>打开文件<code>./build.gradle</code>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    //省略一些代码</div><div class="line">    dependencies &#123;</div><div class="line">        //省略一些代码</div><div class="line">        classpath &apos;com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">allprojects &#123;</div><div class="line">    apply plugin: &apos;com.jfrog.bintray&apos;</div><div class="line">    apply plugin: &quot;maven-publish&quot;</div><div class="line">    //也可以将插件apply到相应的module的build.gradle文件中</div><div class="line">    //省略一些代码</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>定义生成相关产物的Gradle Tasks；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//生成源码jar包task</span></div><div class="line">task androidSourcesJar(<span class="string">type:</span> Jar) &#123;</div><div class="line">    classifier = <span class="string">'sources'</span></div><div class="line">    from android.sourceSets.main.java.srcDirs</div><div class="line">&#125;</div><div class="line">task androidJavadocs(<span class="string">type:</span> Javadoc) &#123;</div><div class="line">    title = <span class="string">"$&#123;getStringProperty("</span>mavProjectName<span class="string">")&#125; $&#123;project.version&#125; API"</span></div><div class="line">    description <span class="string">"Generates Javadoc"</span></div><div class="line">    source = android.sourceSets.main.java.srcDirs</div><div class="line">    classpath += files(android.bootClasspath)</div><div class="line">    android.libraryVariants.all &#123; variant -&gt;</div><div class="line">        <span class="keyword">if</span> (variant.name == <span class="string">'release'</span>) &#123;</div><div class="line">            owner.classpath += variant.javaCompileProvider.get().classpath</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    exclude <span class="string">'**/R.html'</span>, <span class="string">'**/R.*.html'</span>, <span class="string">'**/index.html'</span>, <span class="string">'**/*.kt'</span></div><div class="line">    options &#123;</div><div class="line">        windowTitle(<span class="string">"$&#123;getStringProperty("</span>mavProjectName<span class="string">")&#125; $&#123;project.version&#125; Reference"</span>)</div><div class="line">        locale = <span class="string">'en_US'</span></div><div class="line">        encoding = <span class="string">'UTF-8'</span></div><div class="line">        charSet = <span class="string">'UTF-8'</span></div><div class="line">        links(<span class="string">"http://docs.oracle.com/javase/7/docs/api/"</span>)</div><div class="line">        linksOffline(<span class="string">"http://d.android.com/reference"</span>, <span class="string">"$&#123;android.sdkDirectory&#125;/docs/reference"</span>)</div><div class="line">        setMemberLevel(JavadocMemberLevel.PUBLIC)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//生成javadoc jar包task</span></div><div class="line">task androidJavadocsJar(<span class="string">type:</span> Jar, <span class="string">dependsOn:</span> androidJavadocs) &#123;</div><div class="line">    classifier = <span class="string">'javadoc'</span></div><div class="line">    from androidJavadocs.destinationDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置相关参数；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这里仅仅列出差异部分，其他部分可以参考1.4</span></div><div class="line"></div><div class="line"><span class="comment">//省略一些代码</span></div><div class="line"></div><div class="line">publishing &#123;</div><div class="line">    publications &#123;</div><div class="line">        MyPublication(MavenPublication) &#123;</div><div class="line">            <span class="comment">//标准开源库，以下都三个文件是标配</span></div><div class="line">            artifact(bundleReleaseAar)<span class="comment">//TODO 配置库aar包</span></div><div class="line">            artifact(androidSourcesJar)<span class="comment">//TODO 配置库源码jar包</span></div><div class="line">            artifact(androidJavadocsJar)<span class="comment">//TODO 配置库javadoc jar包</span></div><div class="line">            <span class="comment">//省略一些代码</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>执行上传<code>task bintrayUpload</code>(参考1.5)</p>
<h3 id="3-跳过1和2，直接使用打包封装好的上传发布插件，省去较为繁琐的配置；"><a href="#3-跳过1和2，直接使用打包封装好的上传发布插件，省去较为繁琐的配置；" class="headerlink" title="3. 跳过1和2，直接使用打包封装好的上传发布插件，省去较为繁琐的配置；"></a>3. 跳过1和2，直接使用打包封装好的上传发布插件，省去较为繁琐的配置；</h3></li>
<li><p>引入bintray插件;</p>
<ul>
<li><p>Java/Kotlin工程；</p>
  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// rootProject/build.gradle</span></div><div class="line">plugins &#123;</div><div class="line">    <span class="comment">//省略一些代码...</span></div><div class="line">    id <span class="string">'com.jfrog.bintray'</span> version <span class="string">'1.8.5'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Android工程；</p>
  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// rootProject/build.gradle</span></div><div class="line">buildscript &#123;</div><div class="line">    <span class="comment">//省略一些代码</span></div><div class="line">    dependencies &#123;</div><div class="line">        <span class="comment">//省略一些代码</span></div><div class="line">        classpath <span class="string">'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">allprojects &#123;</div><div class="line">    apply <span class="string">plugin:</span> <span class="string">'com.jfrog.bintray'</span></div><div class="line">    <span class="comment">//也可以将插件apply到相应的module的build.gradle文件中</span></div><div class="line">    <span class="comment">//省略一些代码</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>引入打包封装好的上传发布插件；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//java工程：rootProject/build.gradle</span></div><div class="line"><span class="comment">//android工程:rootProject/module/build.gradle</span></div><div class="line">apply <span class="string">from:</span> <span class="string">"https://cdn.jsdelivr.net/gh/halohoop/cdn@latest/utils/gradle/bintrayIntegrated.gradle"</span></div></pre></td></tr></table></figure>
</li>
<li><p>定义属性参数<br> 各个属性的意义可以通过名称命名去体现；</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//java工程：rootProject/build.gradle</span></div><div class="line"><span class="comment">//android工程:rootProject/module/build.gradle</span></div><div class="line">project.ext &#123;</div><div class="line">    bintrayUser = <span class="string">"halohoop"</span></div><div class="line">    groupId = <span class="string">"com.halohoop"</span></div><div class="line">    artifactId = project.name</div><div class="line">    version = <span class="string">"0.0.3"</span></div><div class="line">    javadocDir = <span class="string">"src/main/java"</span></div><div class="line">    sourceDir = <span class="string">"src"</span></div><div class="line">    bintrayOverride = <span class="literal">true</span></div><div class="line">    bintrayPublish = <span class="literal">true</span></div><div class="line">    bintrayPkgRepo = <span class="string">"maven"</span></div><div class="line">    bintrayPkgName = project.name</div><div class="line">    bintrayPkgUserOrg = project.ext.bintrayUser</div><div class="line">    bintrayPkgLicenses = [<span class="string">'Apache-2.0'</span>]</div><div class="line">    bintrayPkgVcsUrl = <span class="string">"github.com/$&#123;project.ext.bintrayUser&#125;/$&#123;project.ext.bintrayPkgName&#125;.git"</span></div><div class="line">    bintrayPkgIssueTrackerUrl = <span class="string">"github.com/$&#123;project.ext.bintrayUser&#125;/$&#123;project.ext.bintrayPkgName&#125;/issue"</span></div><div class="line">    bintrayPkgVersionDesc = <span class="string">"$&#123;project.ext.bintrayPkgName&#125; $&#123;project.ext.version&#125; final"</span></div><div class="line">    bintrayPkgVersionReleased = <span class="keyword">new</span> Date()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>个人水平有限，欢迎读者勘误。</p>
<ul>
<li>Wechat: halohoop<ul>
<li><a href="https://cdn.jsdelivr.net/gh/halohoop/cdn/github/halohoop_wechat.jpeg" target="_blank" rel="external"><img src="https://cdn.jsdelivr.net/gh/halohoop/cdn/imgs/halohoop_wechat_small.png" alt="wechat"></a></li>
</ul>
</li>
<li>E-mail: <a href="mailto:halohoopwong@gmail.com" target="_blank" rel="external">halohoopwong@gmail.com</a><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a href="https://guides.gradle.org/creating-new-gradle-builds/" target="_blank" rel="external">Creating New Gradle Builds</a></li>
<li><a href="https://github.com/sky-uk/gradle-maven-plugin" target="_blank" rel="external">https://github.com/sky-uk/gradle-maven-plugin</a></li>
</ol>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/02/about_2019_ncov/">整理：关于武汉肺炎可以普及的'知识'</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-02 17:15:00</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/life/">life</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/virus/">virus</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/细菌/">细菌</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/病毒/">病毒</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/李文亮/">李文亮</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/陈秋实/">陈秋实</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/武汉病毒实验室/">武汉病毒实验室</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/方斌/">方斌</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/次氯酸/">次氯酸</a></span><div class="content"><p><img src="/2020/02/02/about_2019_ncov/c908115d0a434800b379ac686beec76e.jpg" alt="武汉加油"></p>
<p><strong>戴口罩，多洗手，别摸口鼻眼，不管是天灾还是人祸，天佑我中华。 </strong></p>
<p><em>声明：以下文章内容大部分转载于网络。</em></p>
<ol>
<li><p>细菌和病毒是同一个东西吗？什么是冠状病毒？</p>
<ol>
<li><p>这个去看李永乐老师的关于冠状病毒的那期就可以了。参考链接：<a href="https://www.ixigua.com/i6786939642429047307/" target="_blank" rel="external">“冠状病毒”是什么？武汉新型肺炎病毒是如何使人生病的？</a>(视频26分钟)。</p>
<p><img src="/2020/02/02/about_2019_ncov/Xnip2020-02-02_19-09-37.png" alt="冠状病毒"></p>
</li>
</ol>
</li>
<li><p>为什么是75%浓度的酒精才可以杀菌？</p>
</li>
<li><p>酒精可以杀灭病毒吗？杀菌消毒和细菌、病毒的外膜(套膜)有什么关系？次氯酸水VS酒精哪个消毒更好？</p>
<p>2和3也都可以通过搜索获得。参考视频：<a href="https://www.youtube.com/watch?v=q_ISwd_rh3M" target="_blank" rel="external">【約翰老師小教室】次氯酸vs酒精vs漂白水</a>(视频2分钟)</p>
<p><img src="/2020/02/02/about_2019_ncov/Xnip2020-02-02_18-40-44.png" alt="有外膜"></p>
<p><img src="/2020/02/02/about_2019_ncov/Xnip2020-02-02_18-34-54.png" alt="无外膜"></p>
<ol>
<li><p>有一个一块钱成本电解制作次氯酸水的视频可以去了解下，这个在应对当前各种酒精脱销的情况下还是挺有用的。参考链接：<a href="https://www.youtube.com/watch?v=hXS6bHcGkw0" target="_blank" rel="external">武漢肺炎 唯有自救才能救人</a>，视频我已经扒下来了，”看不到”可以找我要资源。</p>
<p><img src="/2020/02/02/about_2019_ncov/Xnip2020-02-02_18-35-29.png" alt="次氯酸"></p>
</li>
</ol>
</li>
<li><p>基本传染数R0是什么意思？</p>
<p>参考链接：<a href="https://zhuanlan.zhihu.com/p/104128326?utm_source=wechat_timeline" target="_blank" rel="external">科普 | 基本传染数 R0</a></p>
</li>
<li><p>是真的有哪一篇报道有直接证据证明是因为接触了蝙蝠、野味引起这次瘟疫的嘛？求链接。</p>
<p>在它们身上发现了病毒是否就等于因为接触了而引起？还是为了限制追责，将舆论引至此为止？</p>
</li>
<li><p>“人民日报”是否会不知道双黄连口服液那篇POST发出来之后的结果嘛？</p>
<p><img src="/2020/02/02/about_2019_ncov/WechatIMG776.jpeg" alt="双黄连口服液"></p>
<p>有人去扒了WH病毒实验室所长王某某和双黄连口服液相关制药公司上海绿谷制药有限公司相关的高层的关系，这个思考方向就挺有意思。<a href="https://www.zhihu.com/question/368894346" target="_blank" rel="external">参考链接</a>.</p>
</li>
<li><p>李文亮是谁？经历了什么？做了什么事？</p>
<p>真的可以了解到“打你一巴掌然后再给你糖吃”的精髓是如何被诠释的。</p>
</li>
<li><p>12月底病毒就被检测出来了，1月7才有响应中间是发生了什么？为何响应如此的缓慢和平平。</p>
<ol>
<li>文章请搜索“记录一下首次发现新型冠状病毒的经历”，国内媒体有删帖的可能。</li>
<li>思考：作为纳税人，你能够容忍或原谅国家社会的领导人失职的底线到什么程度？</li>
</ol>
</li>
<li><p>武汉里面到底是怎么样一个状况了？</p>
<p>陈秋实何许人也？口罩哥何许人也？方斌何许人也？……经历了什么？做了什么事？有条件的自行了解。</p>
</li>
</ol>
<p><strong>希望“亲自指挥，亲自部署”的领导人一定要尽早解救我们尤其是被困在严重疫区里面的兄弟姐妹同胞们~</strong></p>
<p><img src="/2020/02/02/about_2019_ncov/WechatIMG775.jpeg" alt="天佑中华"></p>
<p>Just Feel FREEEEEEEEEEE to Contact Me：</p>
<p>Email: <a href="mailto:halohoopwong@gmail.com" target="_blank" rel="external">halohoopwong@gmail.com</a></p>
<p>Wechat: halohoop</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/08/11/explanation_of_uncoupled/">[饼干]如何向你的不懂编程的领导或者朋友解释什么是解耦</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-11 01:10:50</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/programming/">programming</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/cookies/">cookies</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/coding/">coding</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<p>什么叫做解耦，其实就是用一个通用的桥梁去沟通有关联的两者，这里有个关键的点，通用的。不太理解？那就请带着不理解继续往下读，请允许我给您说说我的理解。</p>
<p>​我们学习一个新事物的时候一般都会类比自己已经熟知的相似的事物，要把解耦类比到我们生活中也很简单。想象一个场景，你在一个钉钉群里面共享了一个文件，”报销报表填写.xls”，需要大家填写后发回给你，然而群里大家正聊的热火朝天，很快文件的那条消息就被掩盖了，但是如果提供的是一个下载地址，这就解耦了，为什么解耦了，因为他可以很方便的复用在公告栏、个人资料、聊天昵称等任何的地方中。</p>
<p>我们可能都听过一句经典的名言：“计算机界任何的问题都可以通过引入一个第三方来进行解决”，这里的解耦也是一样的，我们引入的第三方是一个字符串的抽象概念，一段URL字符串地址，可以代表一个exe文件，但是反过来，一个exe文件就不能够代表一个段URL字符串地址了。引入了这个第三方的字符串概念之后，由于它不仅具有路由的属性（即可以通过访问找到目标文件），而且具有了一定的独立性（一串字符集合完整代表了一个文件），而且的而且，又带有绝对可传播的特点（即可以“复制粘贴书写口述”到任何想要的地方）。</p>
<p>所以，解耦你理解了吗？</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/03/06/stateofaprogram/">《用程序的状态来衡量一个程序猿的成长大概是这样》</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-03-06 01:23:10</time><div class="content"><p><img src="/2019/03/06/stateofaprogram/1.png" alt="1"><br><img src="/2019/03/06/stateofaprogram/2.png" alt="2"><br><img src="/2019/03/06/stateofaprogram/3.png" alt="3"></p>
<pre><code>————HQ. 
————19.3.6 
</code></pre></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/10/03/atease/">《心安》</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-03 00:10:40</time><div class="content"><p><img src="/2018/10/03/atease/atease.jpg" alt="atease"></p>
<p>很多时候，“人一旦认定一件事情，想法就会变的片面。”就像脑海里一颗疯狂活化的种子，一旦落地发芽，就肆意生长蔓延。</p>
<p>殊不知，其实自己的想法可以有更多的可能性，只是因为一开始就决定了方向，才导致这样那样的结果或想法。</p>
<p>但是，人一生很多事很多时候可能就只会有那么一个方向，因为通常我们都只交那些能够迁就着你的想法的“伙伴”，鲜有人会再帮你追根溯源再为你重新种下另一颗种子。</p>
<p>很多时候每个人都会认为，我掌握了一项技能，那么我就认定超出这个技能能够完成的事情的范畴的事情，就是无法完成的；我阅人无数，那么我就认定了我只需要只言片语的交流就能够轻易定义他或她是个怎么样的人，有没有资格做我的“伙伴”，甚至都懒得多问一句来直接求证自己的定义；</p>
<p>虽然结果看起来片面，但是这就是人们已经充分利用起来的“经验”，并且已经用很多生活中工作中的事例来反复印证过了的，但是也因此，很多时候也导致很多可能性也许还没有开始就已经宣告结束了。</p>
<p>虽然我们可能没有办法阻止每一个大方向发展的结局，但是我们能够以一种开放的心态来让自己宽容对待这些由于经验带来的或好或坏的结果。</p>
<p>就像即将要了结一个制定好的目标，要能够享受成功带来的喜悦，也要能够承受失败带来的失落。我经常制定的宏大的计划，却没有一次能够完美完成，但是我也会总结原因继续前进。</p>
<p>就像要认真对待的一份爱情，要能够享受爱带来的愉悦，也要能够坦然接纳不爱带来的伤感。好比我，虽然没有人爱我，甚至有时候女孩子连对我多说一句话都懒得说（就是所谓的丑拒，人丑没办法），但我也会坦然的接收这样的事实。</p>
<p>也许这就是所谓的心安吧。</p>
<p>在我，让自己想法足够单纯，是一切心安的原因。我始终藏有一份心意，我希望并且也努力的做到让它是单纯的，美好的，不管别人收或不收，我都会将这一份单纯的美好经营下去，因为这个就是我认定的事情，不在乎结果好坏，不计较得失，也始终相信会有“伙伴”们欣赏这一份独一无二的心意。</p>
<p>努力。</p>
<pre><code>————HQ. 
————18.10.3 
</code></pre></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/13/snacks_android_permission_check/">[点心]Android权限判断中的版本兼容</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-13 00:55:02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tricks/">tricks</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/snacks/">snacks</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<p>在Android中，我们会经常遇到一些需要检查权限允许后才可以进行的一些操作，尤其是Android 6.0以及以后版本最为明显，我们知道Android6.0后引入了运行时权限检查，如果没有权限那么某些隐私的功能就无法使用。<br>那么在针对公司的某些服务，制作一款Android SDK的时候，也是一样的，需要使用到权限检查。<br>庆幸的是，Support Library V4包中已帮我们封装好了一个静态权限检查方法，ContextCompat#checkSelfPermission：</p>
<hr>
<pre><code>ContextCompat.checkSelfPermission(@NonNull Context context, @NonNull String permission)
</code></pre><hr>
<p>我当然可以直接调用这个方法，但是，在打包SDK为Jar的时候就不得不带上这个V4包的，这样会增大SDK整体包的大小，不建议使用，当然我们可以打包的时候不加入这个V4包，然后乞求用户在使用我们SDK的时候加入V4包，但是这显然不是一个专业的操作，用户根据自己的业务需求是不一定会引入V4包的，所以凭什么要使用你SDK的用户去买单，引入一个其他功能都不一定使用到的包。另外，引入这个V4包的SDK集成到其他应用中时候还有可能造成V4包冲突的风险，因为其他应用可能也有用到V4包。</p>
<p>作为一个有节操的SDK，必须解决这个问题，又因为V4是Android屏蔽版本区别的一个支持库，因此其中的方法一定是版本兼容的，于是在技术本能的驱使下，我深入这个checkSelfPermission方法一探究竟：</p>
<hr>
<pre><code>public static int checkSelfPermission(@NonNull Context context, @NonNull String permission) {
    if (permission == null) {
        throw new IllegalArgumentException(&quot;permission is null&quot;);
    }
    return context.checkPermission(permission, android.os.Process.myPid(), Process.myUid());
}
</code></pre><hr>
<p>核心方法就是一句，调用Context#checkPermission方法，返回的int类型不同的值代表不同的权限。见下图。</p>
<p><img src="/2018/07/13/snacks_android_permission_check/1.png" alt="demo1"></p>
<p>燃鹅，我觉得这个方法需要太多参数，因为在一个应用，后面两个参数其实都是固定的，pid和uid（具体这两个变量是什么含义可以自行查阅），Google应该没有傻到让我做多余的事情，因此我决定进一步寻找，于是找到了这个方法Context#checkSelfPermission，果然只需要传递一个String权限参数，哈哈，和Google想到一块儿去了。见下图。</p>
<p><img src="/2018/07/13/snacks_android_permission_check/2.png" alt="demo2"></p>
<p>燃鹅的再燃鹅，看看左上角，这个方法特么的是“added in API level 23”，也就是说我在Android 6.0 以下的SDK中特么的无法使用啊，法使用啊，使用啊，用啊，啊。<br>如果有跟上我思路的童鞋，在这里可能就会有小疑问了：为什么既然这个方法在API 23才有，那我就增加如下的版本判断就好了呀：</p>
<hr>
<pre><code>if (Build.VERSION.SDK_INT &gt;= 23) {
    //call Context#checkSelfPermission
}
</code></pre><hr>
<p>但是，其实您并不能保证其他人在使用你的代码编译的时候的Androi SDK版本一定是≥23的，如果是不≥23的Android SDK版本去编译，编译就挂了。因此为了兼容编译的版本，我们使用反射来调用这个方法，取消方法名的显式调用，这样就不会有找不到这个方法的编译问题。所以现在我们的代码就变成了这样：</p>
<hr>
<pre><code>public static boolean checkSelfPermission(Context context, String permission) {
    boolean permissionGranted = false;
    if (context == null) {
        return false;
    } else {
        if (Build.VERSION.SDK_INT &gt;= 23) {
            try {
                Class clz = Class.forName(&quot;android.content.Context&quot;);
                Method checkSelfPermission = clz.getMethod(&quot;checkSelfPermission&quot;, new
                        Class[]{String.class});
                int i = ((Integer) checkSelfPermission.invoke(context, new
                        Object[]{permission})).intValue();
                if (i == PackageManager.PERMISSION_GRANTED) {
                    permissionGranted = true;
                } else {
                    permissionGranted = false;
                }
            } catch (Throwable e) {
                e.printStackTrace();
            }
        }
    }
    return permissionGranted;
}
</code></pre><hr>
<p>但是的但是，现在显然这个方法是只能提供给API 23的权限检车使用的，因为进行了版本判断。我们再增加如下的代码片将API 22以及以下的版本给兜住喽：</p>
<hr>
<pre><code>PackageManager packageManager = context.getPackageManager();
if (packageManager.checkPermission(permission, context.getPackageName()) ==
                        PackageManager.PERMISSION_GRANTED) {
    permissionGranted = true;
}
</code></pre><hr>
<p>可能到这里又会有同学问了，既然只是判断是否授权，一个布尔值，那干脆全部使用上述的代码片段就好了哇。确实可以这样的，但是其实根据Support Library中的思路，有新的API，都会面向使用更(gèng)新的API，比如，V4包中的DrawableCompat类，在不同的版本会new不同版本的实例，这里也是一样的，不同版本走不同的逻辑，因此我们最终的权限判断方法就变成了如下的样子（针对if增加了一个else）：</p>
<hr>
<pre><code>public static boolean checkSelfPermission(Context context, String permission) {
    boolean permissionGranted = false;
    if (context == null) {
        return false;
    } else {
        if (Build.VERSION.SDK_INT &gt;= 23) {
            try {
                Class clz = Class.forName(&quot;android.content.Context&quot;);
                Method checkSelfPermission = clz.getMethod(&quot;checkSelfPermission&quot;, new
                        Class[]{String.class});
                int i = ((Integer) checkSelfPermission.invoke(context, new
                        Object[]{permission})).intValue();
                if (i == PackageManager.PERMISSION_GRANTED) {
                    permissionGranted = true;
                } else {
                    permissionGranted = false;
                }
            } catch (Throwable e) {
                e.printStackTrace();
            }
        } else {//新增
            PackageManager packageManager = context.getPackageManager();
            if (packageManager.checkPermission(permission, context.getPackageName()) ==
                    PackageManager.PERMISSION_GRANTED) {
                permissionGranted = true;
            }
        }
    }
    return permissionGranted;
}
</code></pre><hr>
<p>另外，还有最后一点，我们的反射的API在Android中并不是@Hide标记的，因此，按理应不会在以后的Android版本中（比如Android 9.0 中），被禁用。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/10/05/cookies_how_to_get_aar/">[饼干]如何获取官方的aar包</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-10-05 17:56:20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/programming/">programming</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/cookies/">cookies</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/android/">android</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/maven/">maven</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/aar/">aar</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>怎么获取开源项目的aar包。</li>
<li>support library的aar包又怎么获取呢。</li>
</ol>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>首先我们来看看这个问题是如何产生的，因为公司需要配置Jenkins离线打包，具体的操作我也写了一篇博文来描述踩坑过程，<a href="http://halohoop.com/2017/10/05/nothing/">《Ubuntu下结合Github搭建Jenkins自动打Android包》</a>，显然，点进去之后你会发现被我坑了，因为我还时间没写完。</p>
<p>公司需要配置Jenkins离线打包，服务器为了避免编译的时候下载很多的未知的资源，以及缩短编译时间，因此如果安卓的项目中如果在build.gradle中使用compile、api或者implementation引用开源项目的话，比如：</p>
<pre><code>compile &apos;com.android.support:appcompat-v7:26.1.0&apos;
</code></pre><p>如果服务器的sdk中没有下载有这个26版本的库，那么就很可能会导致离线编译不通过，因为专门用于编译工作的服务器有时候是没有必要连接外网的，没有外网就意味着不能够下载相关的引用的资源或者代码，因此我们通常会需要引用的开源项目的aar包，来支持离线编译。<br>然而通过compile、api或者implementation引用开源项目，我们在本地很可能会找不到aar，哪怕在build里面也找不到。<br>这个时候开头说的两个需求就来了。我们当然可以通过下载开源项目的源代码然后手动打aar包<a href="https://www.google.com.hk/search?safe=strict&amp;q=%E6%89%93aar%E5%8C%85&amp;oq=%E6%89%93aar%E5%8C%85&amp;gs_l=psy-ab.12..0i10i42k1.622035.622035.0.622425.1.1.0.0.0.0.264.264.2-1.1.0....0...1.1.64.psy-ab..0.1.262....0.MwxG2Y8zpJE" target="_blank" rel="external">[谷歌一下]</a>的方式来得到，当然我们也可以通过官方的下载渠道得到。接下来就介绍一下如何获取官方的aar包。</p>
<h2 id="获取官方的aar包"><a href="#获取官方的aar包" class="headerlink" title="获取官方的aar包"></a>获取官方的aar包</h2><h3 id="获取开源项目的aar包"><a href="#获取开源项目的aar包" class="headerlink" title="获取开源项目的aar包"></a>获取开源项目的aar包</h3><p>四个步骤，简单到怀疑人生</p>
<ol>
<li>打开链接<br><a href="https://search.maven.org/#search" target="_blank" rel="external">https://search.maven.org/#search</a></li>
<li>搜索开源项目名字<ul>
<li>a. 比如搜索okhttp<br><img src="/2017/10/05/cookies_how_to_get_aar/5eb1829e-63d9-44cd-a217-3355d3f8cfe9.png" alt=""></li>
</ul>
</li>
<li><p>下载</p>
<ul>
<li>a.这里需要说的一点就是，由于有些开源项目比如说squareup的okhttp，只是一个类库，也就是全部都是class文件，因此是不需要打包成aar包的，只需要一个jar包即可。</li>
<li>b.点击对应开源项目的“jar”或者“aar”即可下载到对应版本的，如下图<br><img src="/2017/10/05/cookies_how_to_get_aar/b623fb45-dc06-42f3-bb6f-2a7a01c7ebfd.png" alt=""></li>
<li><p>c.一般这个的版本都是最新发布的版本，如果不是想要的版本的时候，可以点击下图中的“all”，就能够得到所有的已发布的版本，这时候点击对应aar或者jar下载需要的包即可。<br><img src="/2017/10/05/cookies_how_to_get_aar/0ca1de32-e796-4991-9a05-0bf6082c67e9.png" alt=""><br><img src="/2017/10/05/cookies_how_to_get_aar/aad5e099-a4fc-41da-9f3e-3c24ab2491bb.png" alt=""></p>
<h3 id="获取support-library的aar包"><a href="#获取support-library的aar包" class="headerlink" title="获取support library的aar包"></a>获取support library的aar包</h3></li>
<li>比如需要找到appcompat-v7的25.3.1版本，去SDK下相应的文件夹下就能够找到了<ul>
<li>[SDK_DIR]\extras\android\m2repository\com\android\support\appcompat-v7\25.3.1</li>
</ul>
</li>
<li>如果不知道有什么版本怎么办，别怕，谷歌出品必属精品，肯定有迹可循的嘛<ul>
<li>打开这个网址即可查看最近的和最新的发布的支持包版本了：<a href="https://developer.android.com/topic/libraries/support-library/revisions.html" target="_blank" rel="external">Recent Support Library Revisions</a></li>
</ul>
</li>
</ul>
</li>
<li><p>引用</p>
</li>
</ol>
<hr>
<pre><code>//引用aar包配置
dependencies {
    //compile(name: &apos;xxx&apos;, ext: &apos;aar&apos;)
    compile(name:&apos;mylib-release&apos;, ext:&apos;aar&apos;)
}
repositories{
    flatDir{
        dirs &apos;libs&apos;
    }
}
</code></pre><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><p>如果想要更加深入拓展研究透彻，推荐可以从这些个方向去深入：</p>
<ol>
<li>如何打aar包。</li>
<li>build.gradle中compile、api或者implementation回来依赖库在本地是以怎么样的形式存在的。<ul>
<li>是一堆的资源文件和*.class文件还是什么？</li>
<li>存在什么目录中？build文件夹中？</li>
<li>难道不是compile引用一个库不是下载其aar包到本地么？</li>
</ul>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/08/08/snacks-wave_float_text_view/">[点心]自定义控件之这文字有点浪-Kotlin实现</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-08-08 03:03:20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/programming/">programming</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/android/">android</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/effect/">effect</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/snacks/">snacks</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/custom-view/">custom_view</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<p>控件源码：<a href="https://github.com/halohoop/AndroidDigIn#24带文字的波浪" target="_blank" rel="external">https://github.com/halohoop/AndroidDigIn#24带文字的波浪</a></p>
<h2 id="壹-效果图"><a href="#壹-效果图" class="headerlink" title="壹.效果图"></a>壹.效果图</h2><p><img src="/2017/08/08/snacks-wave_float_text_view/device-2017-07-13-004908.gif" alt="demo0"></p>
<h2 id="贰-知识点"><a href="#贰-知识点" class="headerlink" title="贰.知识点"></a>贰.知识点</h2><ul>
<li>1.SurfaceView子线程高效绘制；</li>
<li>2.贝塞尔曲线画波浪；</li>
<li>3.文字测量；</li>
<li>4.Kotlin语法；</li>
<li>5.Region+Path的使用；</li>
</ul>
<h2 id="叁-背景-amp-介绍"><a href="#叁-背景-amp-介绍" class="headerlink" title="叁.背景&amp;介绍"></a>叁.背景&amp;介绍</h2><ul>
<li>给自己的需求是酱的：想要实现一个随着波浪浮动的文字。</li>
<li>可能是因为使用kotlin语法简洁的缘故，代码只有不到400行。</li>
<li>用工的孩子时间都不多，心照啦，所以全文会尽量不说废话或少说废话，先来一句废话，么么哒。</li>
</ul>
<h2 id="肆-使用方式"><a href="#肆-使用方式" class="headerlink" title="肆.使用方式"></a>肆.使用方式</h2><ul>
<li>改变速度，绘制的时候就是根据速度的值来决定波浪移动的距离的，代码见下文的绘制方法</li>
</ul>
<hr>
<pre><code>progress.setOnSeekBarChangeListener(object : SeekBar.OnSeekBarChangeListener {
    override fun onProgressChanged(seekBar: SeekBar?, progress: Int, fromUser: Boolean) {
        val value = progress.toFloat()
        view.mSpeed = if (value&lt;=0) 1F else value
    }

    ...
})
</code></pre><hr>
<ul>
<li>修改文字，可以看到Kotlin的set我们只需要直接给变量赋值即可。</li>
</ul>
<hr>
<pre><code>view实例.text = &quot;中abcdefghijkl文&quot;

//具体的set、get方法
var text: String = &quot;Halohoop&quot;
    set(value) {
        stopLoopDraw()//先暂停
        lock(lockObj,{
            field = value
            val textPosMidX = mMidX;
            updateTextsConfigs(value, textPosMidX)
        })
        startLoopDraw()//重新开始
    }
    get
</code></pre><hr>
<h2 id="伍-拆解轮子"><a href="#伍-拆解轮子" class="headerlink" title="伍.拆解轮子"></a>伍.拆解轮子</h2><h3 id="1-绘制波浪。"><a href="#1-绘制波浪。" class="headerlink" title="1.绘制波浪。"></a>1.绘制波浪。</h3><ul>
<li>准备波浪Path<ul>
<li>如下图，不管你屏幕中画多少个周期，你给我<strong>画多一个周期</strong>出来用作移动就好了，每次朝一个方向移动完一个周期就重置。</li>
<li><img src="/2017/08/08/snacks-wave_float_text_view/demo1.png" alt="demo1"></li>
<li>取巧的方法是Path.rQuadTo方法，而不是直接用Path.quadTo，因为可以相对于上一个Path移动到的位置作为起点。</li>
<li>看码</li>
</ul>
</li>
</ul>
<hr>
<pre><code>private fun drawWave(canvas: Canvas?) {
    paint.color = WAVE_COLOR
    val quaterWaveWidth = mHalfWaveWidth / 2f;//四分之一个周期

    path.rewind()//重置path，清空路径

    val dx = mDx;//移动的距离
    path.moveTo(0f - mHalfWaveWidth * 2f + dx, mMidY)//移动到开始点

    for (i in 0..mWaveCount) {
        path.rQuadTo(quaterWaveWidth, mWaveHeight, mHalfWaveWidth, 0f)
        path.rQuadTo(quaterWaveWidth, -mWaveHeight, mHalfWaveWidth, 0f)
    }

    path.lineTo(measuredWidth.toFloat(), measuredHeight.toFloat())//和右下角连接起来
    path.lineTo(0f, measuredHeight.toFloat())//和左下角连接起来
    path.close()//封闭起来

    canvas?.drawPath(path, paint)
}
</code></pre><hr>
<h3 id="2-拆解文字，得到文字绘制的区域Rect。"><a href="#2-拆解文字，得到文字绘制的区域Rect。" class="headerlink" title="2.拆解文字，得到文字绘制的区域Rect。"></a>2.拆解文字，得到文字绘制的区域Rect。</h3><ul>
<li>看码，你应该注意到方法中又定义方法，这是Kotlin特性，就是这么任性，抄抄JavaScript有时还抄抄C++抄抄Groovy…</li>
<li>看码中注释即可，不废话</li>
</ul>
<hr>
<pre><code>//用于计算文字位置的Region集合
private var mTextPositionHelperRegions: ArrayList&lt;Region&gt;? = null
//每个文字的宽度数组
private lateinit var mEveryLetterWidths: FloatArray
...
@MainThread
private fun updateTextsConfigs(newText: String, textPosMidX: Float) {

    //获取每个文字的宽度
    fun getEveryLetterWidth(text: String) : FloatArray{
        mEveryLetterWidths = FloatArray(text.length)
        textPaint.getTextWidths(text, 0, text.length, mEveryLetterWidths)
        return mEveryLetterWidths
    }

    //得到所有文字的总宽
    fun getHowWidthOfTexts(everyLetterWidths: FloatArray): Float {
        mHowWidthOfTexts = 0f;
        everyLetterWidths.forEach { mHowWidthOfTexts += it }
        return mHowWidthOfTexts
    }

    //得到所有的文字的绘制区域，放入集合中
    fun updateTextPositionHelperRegions(textPosMidX: Float = 0f, howWidthOfTexts: Float,
                                                everyLetterWidths: FloatArray) {
        val startX = textPosMidX - howWidthOfTexts / 2
        val tmpEveryLetterWidths = everyLetterWidths
        var tmpHowWidthOfTexts = howWidthOfTexts
        val lettersCount = tmpEveryLetterWidths.size

        if (mTextPositionHelperRegions != null) {
            mTextPositionHelperRegions!!.clear()
            mTextPositionHelperRegions = null
        }
        mTextPositionHelperRegions = ArrayList&lt;Region&gt;()

        for (i in lettersCount - 1 downTo 0) {//倒序遍历每个字
            if (tmpHowWidthOfTexts &lt; 0) tmpHowWidthOfTexts = 0f
            tmpHowWidthOfTexts -= tmpEveryLetterWidths[i]
            val region = Region((startX - 1 + tmpHowWidthOfTexts).toInt(), 0,
                    (startX + tmpHowWidthOfTexts).toInt(), measuredHeight)
            mTextPositionHelperRegions!!.add(0, region)//往最前面插
        }
    }

    val everyLetterWidths = getEveryLetterWidth(newText)
    //get how width of texts
    val howWidthOfTexts = getHowWidthOfTexts(everyLetterWidths)
    //initialize TextPositionHelperRegions
    updateTextPositionHelperRegions(textPosMidX, howWidthOfTexts, everyLetterWidths)
}
</code></pre><hr>
<h3 id="3-通过region得到波浪Path上的x，y坐标，将文字画出来。"><a href="#3-通过region得到波浪Path上的x，y坐标，将文字画出来。" class="headerlink" title="3.通过region得到波浪Path上的x，y坐标，将文字画出来。"></a>3.通过region得到波浪Path上的x，y坐标，将文字画出来。</h3><hr>
<pre><code>private fun drawTexts(canvas: Canvas?) {
    textPaint.color = TEXT_COLOR
    var i = 0
    val toCharArray = text!!.toCharArray()
    mTextPositionHelperRegions?.forEach {
        //以下这句是得到波浪上点的关键
        //会往it,也就是mTextPositionHelperRegions的一个元素Region里面塞入裁剪之后的Rect
        mRegion.setPath(path, it)//里面记录了Path和Region相交的四个方向的最值。
        if (DEBUG) {
            //debug
            canvas?.drawRect(it.bounds, textPaint)
        }

        //使用左和上值绘制文字
        canvas?.drawText(toCharArray[i] + &quot;&quot;, it.bounds.left.toFloat(), mRegion.bounds.top.toFloat(), textPaint)
        if (DEBUG &amp;&amp; i == 0) {
            canvas?.drawText(text, it.bounds.left.toFloat(), mRegion.bounds.top.toFloat() - 100, textPaint)
        }
        i++
    }
}
</code></pre><hr>
<h3 id="4-设置动画动起来和停下，当你非常确定一个变量不为空的时候可以加入“-”拒绝kotlin帮你做好的空指针危险限制。"><a href="#4-设置动画动起来和停下，当你非常确定一个变量不为空的时候可以加入“-”拒绝kotlin帮你做好的空指针危险限制。" class="headerlink" title="4.设置动画动起来和停下，当你非常确定一个变量不为空的时候可以加入“!!”拒绝kotlin帮你做好的空指针危险限制。"></a>4.设置动画动起来和停下，当你非常确定一个变量不为空的时候可以加入“!!”拒绝kotlin帮你做好的空指针危险限制。</h3><hr>
<pre><code>fun startFlow() {
    stopFlow()
    flowAnimator = ValueAnimator.ofFloat(0f, mHalfWaveWidth * 2)
            .setDuration(1000)
    flowAnimator!!.setRepeatMode(ValueAnimator.RESTART)
    flowAnimator!!.setRepeatCount(ValueAnimator.INFINITE)
    flowAnimator!!.interpolator = LinearInterpolator()
    flowAnimator!!.addUpdateListener {
        mDx = it.animatedValue as Float
        this@WaveWithTextView.invalidate(0, (mMidY - mWaveHeight).toInt(), measuredHeight, (mMidY + mWaveHeight).toInt())
    }

    flowAnimator!!.start()
}

fun stopFlow() {
    if (flowAnimator != null &amp;&amp; flowAnimator!!.isRunning &amp;&amp; flowAnimator!!.isStarted) {
        flowAnimator!!.cancel()
        flowAnimator = null
    }
}
</code></pre><hr>
<h3 id="5-使用SurfaceView子线程绘制实现。"><a href="#5-使用SurfaceView子线程绘制实现。" class="headerlink" title="5.使用SurfaceView子线程绘制实现。"></a>5.使用SurfaceView子线程绘制实现。</h3><ul>
<li>5.1.这里贴出关键绘制线程run方法代码：<ul>
<li>其中是抽象方法onThreadRenderDraw，负责使用给的Canvas绘制工作，执行在子线程中.</li>
<li>更多详情请参阅BaseSurfaceWaveWithTextsViewKotlin原码。</li>
</ul>
</li>
</ul>
<hr>
<pre><code>override fun run() {
    val startTime = System.currentTimeMillis()
    while (true) {
        if (!mIsRunning) {//控制是否开始波浪起伏
            Log.i(&quot;halohoop&quot;, &quot;Halohoop--&quot; + &quot;stop&quot;)
            break
        }
        val canvas = mSurfaceHolder.lockCanvas()
        if (canvas != null) {
            lock(lockObj, {
                if (mIsRunning) {
                    onThreadRenderDraw(canvas, System.currentTimeMillis() - startTime)
                }
            })
            //绘制完成
            mSurfaceHolder.unlockCanvasAndPost(canvas)
        }
        try {
            Thread.sleep(SLEEP_TIME)//用于保证和垂直刷新信号同步的时间差
        } catch (e: InterruptedException) {
            e.printStackTrace()
        }
    }
}
...
companion object {
    private val SLEEP_TIME: Long = 16//毫秒
}
...
//其中onThreadRenderDraw是基类的抽象方法，
//具体需要话什么需要子类自己去实现
//并且这个方法是在子线程中进行绘制的。
@WorkerThread
protected abstract fun onThreadRenderDraw(canvas: Canvas, l: Long)
</code></pre><hr>
<ul>
<li>5.2.多线程加锁工具方法，由于涉及线程因此一些关键状态的修改需要加锁</li>
</ul>
<hr>
<pre><code>fun &lt;T&gt; lock(lock: Lock, body: () -&gt; T) {//为了加锁方便，定义了一个加锁工具方法
    lock.lock()
    try {
        body()
    }
    finally {
        lock.unlock()
    }
}
...
//使用示例
override fun surfaceDestroyed(holder: SurfaceHolder) {
    lock(lockObj,{
        stopLoopDraw()
    })
}
</code></pre><hr>
<ul>
<li>5.3.具体的绘制过程</li>
</ul>
<hr>
<pre><code>override fun onThreadRenderDraw(canvas: Canvas, l: Long) {
    canvas.drawColor(Color.WHITE)

    //当你单位时间水平方向的移动距离越大时候，速度就越快
    mDx += mSpeed
    if (mDx &gt;= mHalfWaveWidth * 2) {
        mDx = 0f
    }

    if (DEBUG) {
        canvas?.drawLine((measuredWidth shr 1).toFloat(), 0f,
                (measuredWidth shr 1).toFloat(), measuredHeight.toFloat(), paint)
    }

    drawTexts(canvas)//画文字
    drawWave(canvas)//画波浪

}

//没什么可说的，一目了然的命名
private fun drawWave(canvas: Canvas?) {
    paint.color = WAVE_COLOR
    val quaterWaveWidth = mHalfWaveWidth / 2f;

    path.rewind()//清空旧path

    val dx = mDx;
    path.moveTo(0f - mHalfWaveWidth * 2f + dx, mMidY)

    for (i in 0..mWaveCount) {
        path.rQuadTo(quaterWaveWidth, mWaveHeight, mHalfWaveWidth, 0f)
        path.rQuadTo(quaterWaveWidth, -mWaveHeight, mHalfWaveWidth, 0f)
    }

    path.lineTo(measuredWidth.toFloat(), measuredHeight.toFloat())
    path.lineTo(0f, measuredHeight.toFloat())
    path.close()

    canvas?.drawPath(path, paint)
}

private fun drawTexts(canvas: Canvas?) {
    textPaint.color = TEXT_COLOR
    var i = 0
    val toCharArray = text!!.toCharArray()
    mTextPositionHelperRegions?.forEach {
        //kotlin的forEach遍历可以使用it来接收每一轮遍历的结果
        mRegion.setPath(path, it)
        //当一个Region和path相交的时候
        //这个path在这个region中被用一个Rect来描述，也就是下面的bounds
        //因此就能够得到这个path被region裁剪之后四边之最，左上右下
        if (DEBUG) {
            //debug
            canvas?.drawRect(it.bounds, textPaint)
        }

        canvas?.drawText(toCharArray[i] + &quot;&quot;, it.bounds.left.toFloat(), mRegion.bounds.top.toFloat(), textPaint)
        if (DEBUG &amp;&amp; i == 0) {
            canvas?.drawText(text, it.bounds.left.toFloat(), mRegion.bounds.top.toFloat() - 100, textPaint)
        }
        i++
    }
}
</code></pre><hr>
<h2 id="陆-新需求迭代展望："><a href="#陆-新需求迭代展望：" class="headerlink" title="陆.新需求迭代展望："></a>陆.新需求迭代展望：</h2><ul>
<li>1.支持使用图片替换文字。</li>
<li>2.添加TextureView的版本，因为TextureView可以做view的动画。</li>
<li>3.加入角度的旋转，打造文字随着波浪的切线摆动，会更加真实，欢迎继续关注。</li>
</ul>
<h2 id="柒-最后"><a href="#柒-最后" class="headerlink" title="柒.最后"></a>柒.最后</h2><p>声明：此控件没有经过完整测试，纯练手控件，不要随便在项目中使用，请自行完善。<br>思想为主，知识为辅，Coding随后。<br>如果读者还有不明朗的地方，欢迎查看源码，并且给我提bug，一起为这个社区做出自己的微薄贡献。</p>
<p>控件源码：<a href="https://github.com/halohoop/AndroidDigIn#24带文字的波浪" target="_blank" rel="external">https://github.com/halohoop/AndroidDigIn#24带文字的波浪</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/08/05/dewdrops-peace_in_your_heart/">[露水]做技术，浮躁的人那么多，踏实的人那么少</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-08-05 03:39:02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tricks/">tricks</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/dewdrops/">dewdrops</a></span><div class="content"><p><strong><em>声明：博文未经授权一律不允转载</em></strong></p>
<p>浮躁的人太多，加之网络键盘侠太多，动动手指，就能发泄自己的不满、自己的脾气，惯用自以为看清了一切的口气说话。</p>
<p>天天忙的事情就是发现谁在装逼，然后自己又配合装逼来应和一下，在真实的世界实际的人际交往的时候或者相互认识的网络群中，这个举措或许会很有用，因为能够拉近彼此间的距离，但是彼此互相都不认识在网络世界的交流，一点用都没有的，至少我是这么认为的，如果说有那肯定也只是yy出来的有用罢了，所以说不要做这样的人，这样的人太浮躁，做技术就重要的就是真诚、落地和专注，而不是轻易的就被一件事情吸引，心生杂念。</p>
<p>经常看见身边的或者是各种技术群里的人，看到一个人知道自己不知道的，就想要去做比较，想要比较这个和自己出现在同一个平台上的人是不是比自己学会的更多，想要知道到底他是怎么知道的，为什么会知道，久而久之，变成了“他怎么可能会比我还知道”，养成了容易心生嫉妒的习惯，嘴上称赞心理却很嫉妒，于是处处攀比，无法自拔，浮躁由此而生。</p>
<p>细想，这可能是技术圈里很容易出现的一种情况，原因我想可能就是因为技术圈的快节奏以及高复杂度。<br>快节奏，只要你不是个无理想的富二代，那“不甘落后于别人”以及“危机感”就是你在这个社群中固有的属性，落后于是追赶，被追上于是加速，于是我们的圈子节奏越来越快。<br>高复杂度，就是说技术圈中技术成百上千，就拿计算机语言来说，榜上有名的<a href="https://www.tiobe.com/tiobe-index//programming-languages-definition/#instances" target="_blank" rel="external">语言</a>就有200+种，每一种都是一个世界，这些世界或多或少的又可以相互沟通，每个人都会出现在这些大大小小世界中的某一片天空下，所以我享受的云彩可能在你的位置享受不到，反之亦然，因此出现“你了解的可能我不了解，我了解的可能你不了解”是很正常的。</p>
<p>所以说网络上就出现了“程序员之间的鄙视链”.做技术的人不要总觉得比别人高人一等，不要觉得自己比别人聪明、比别人有优势，我觉得这是最没有用的，把姿态放的足够低，厚积薄发才是真正应该做的。</p>
<p>再举个例子，有一句话是这么说的，“不能适应改需求的设计不是好设计”，不同的人对这句话的理解和体会可能会不一样，积极踏实的人，“哎！确实是这么回事，我要努力达到这个境界”，消极浮躁的人，“我艹，这肯定是产品说出来的话，不是程序猿说的”，你看，已相差甚远。只有积极踏实的人才能够真正从不好中发现美好和对自己的有意义的细节。</p>
<p>我写这篇的目的不是为了说明自己做的有多么好，我只是觉得我很庆幸已经有这种觉悟并且觉得有义务分享出来罢了。</p>
<p>————卖牙膏的芖口钉</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;1997 - 2020 By Halohoop</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>